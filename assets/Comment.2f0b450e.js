import{N as e,d as t,z as a,r as l,O as n,o,c as i,a as s,u as m,t as u,l as d,n as v,P as c,q as r,v as p,s as h,M as g,F as k,J as C,j as y,x as I,y as x,_ as b,k as f,Q as T,m as $,b as _,e as D}from"./index.f7ca6637.js";import{E}from"./el-select.eaa82643.js";const w=t=>e({url:`/comment/playlist?timerstamp=${Date.now()}`,method:"GET",params:t}),j=t=>e({url:`/comment/like?timerstamp=${Date.now()}`,method:"GET",params:t}),q=t=>e({url:`/comment?timerstamp=${Date.now()}`,method:"GET",params:t}),S=t=>e({url:`/comment/album?timerstamp=${Date.now()}`,method:"GET",params:t});var B=(e=>(e[e.song=0]="song",e[e.mv=1]="mv",e[e.playlist=2]="playlist",e[e.album=3]="album",e[e.radiioStationProgram=4]="radiioStationProgram",e[e.video=5]="video",e[e.post=6]="post",e[e.radiioStation=7]="radiioStation",e))(B||{});const F=e=>(I("data-v-777b6a32"),e=e(),x(),e),L=["onContextmenu"],R=["src"],z={class:"detail"},G={class:"nameAndText"},O={class:"text"},A={key:0,id:"reply"},H={class:"text"},N={class:"timeAndTool"},P={class:"time"},U={class:"commentTool"},X=[F((()=>s("svg",{class:"icon","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-dianzan"})],-1)))],Y={class:"supportCount"},J=C('<div class="gap" data-v-777b6a32>|</div><div class="share" data-v-777b6a32><svg class="icon" aria-hidden="true" data-v-777b6a32><use xlink:href="#icon-fenxiang" data-v-777b6a32></use></svg></div><div class="gap" data-v-777b6a32>|</div>',3),M=[F((()=>s("svg",{class:"icon","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-pinglun"})],-1)))],Q=F((()=>s("div",{class:"iconItem"},[s("svg",{class:"icon","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-lajitong"})])],-1))),V={key:0,id:"commentDialog"},K=[F((()=>s("svg",{class:"icon","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-guanbi"})],-1)))],W=F((()=>s("div",{class:"text"},"确定删除该评论？",-1))),Z=b(t({__name:"Comment",props:{commentItem:{type:Object,required:!0},likeCommentButton:{type:Function,required:!0},replyComment:{type:Function,required:!0},deleteComment:{type:Function,required:!0}},setup(e){const t=e,C=y(),I=a();let x=l(!1),b=l(-200),f=l(-200),T=l(!1);const $=e=>{t.commentItem.user.userId==I.uid&&(T.value=!0,b.value=e.clientX,f.value=e.clientY)},_=e=>{e.preventDefault(),T.value=!1};document.addEventListener("contextmenu",_,!0);const D=e=>{e.preventDefault(),T.value=!1};return document.addEventListener("click",D),n((()=>{document.removeEventListener("contextmenu",_,!0),document.removeEventListener("click",D)})),(a,l)=>{var n,y,I,_,D,E,w,j,q,S,B,F,Z,ee,te;return o(),i(k,null,[s("div",{class:"contentItem",onContextmenu:c($,["prevent"])},[s("img",{src:`${null==(y=null==(n=e.commentItem)?void 0:n.user)?void 0:y.avatarUrl}?param=60y60`,onClick:l[0]||(l[0]=t=>{var a,l;return m(C).push(`/user/${null==(l=null==(a=e.commentItem)?void 0:a.user)?void 0:l.userId}`)})},null,8,R),s("div",z,[s("div",G,[s("span",{class:"name",onClick:l[1]||(l[1]=t=>{var a,l;return m(C).push(`/user/${null==(l=null==(a=e.commentItem)?void 0:a.user)?void 0:l.userId}`)})},u(null==(_=null==(I=e.commentItem)?void 0:I.user)?void 0:_.nickname),1),s("span",O," : "+u(null==(D=e.commentItem)?void 0:D.content),1)]),(null==(w=null==(E=e.commentItem)?void 0:E.beReplied)?void 0:w.length)?(o(),i("div",A,[s("div",{class:"name",onClick:l[2]||(l[2]=t=>{var a,l,n;return m(C).push(`/user/${null==(n=null==(l=null==(a=e.commentItem)?void 0:a.beReplied[0])?void 0:l.user)?void 0:n.userId}`)})},"@"+u(null==(S=null==(q=null==(j=e.commentItem)?void 0:j.beReplied[0])?void 0:q.user)?void 0:S.nickname),1),s("div",H," : "+u(null==(F=null==(B=e.commentItem)?void 0:B.beReplied[0])?void 0:F.content),1)])):d("",!0),s("div",N,[s("div",P,u(null==(Z=e.commentItem)?void 0:Z.timeStr),1),s("div",U,[s("div",{class:"supportAndCount",onClick:l[3]||(l[3]=t=>{var a,l;return e.likeCommentButton(null==(a=e.commentItem)?void 0:a.commentId,(null==(l=e.commentItem)?void 0:l.liked)?0:1)})},[s("div",{class:v(["support",{supportOverOne:(null==(ee=e.commentItem)?void 0:ee.likedCount)>0}])},X,2),s("span",Y,u(null==(te=e.commentItem)?void 0:te.likedCount),1)]),J,s("div",{class:"reply",onClick:l[4]||(l[4]=a=>t.replyComment(e.commentItem))},M)])])])],40,L),r(s("div",{id:"commentDelete",style:g(`--deleteX:${m(b)}px;--deleteY:${m(f)}px;`)},[Q,s("div",{class:"text",onClick:l[5]||(l[5]=e=>{h(x)?x.value=!0:x=!0,h(T)?T.value=!1:T=!1})},"删除(Delete)")],4),[[p,m(T)]]),m(x)?(o(),i("div",V,[s("div",{class:"iconItem",onClick:l[6]||(l[6]=e=>h(x)?x.value=!1:x=!1)},K),W,s("div",{class:"confirmButton",onClick:l[7]||(l[7]=e=>{t.deleteComment(t.commentItem),h(x)?x.value=!1:x=!1})},"确定")])):d("",!0)],64)}}}),[["__scopeId","data-v-777b6a32"]]),ee=e=>(I("data-v-c1a54d30"),e=e(),x(),e),te={id:"comment"},ae={id:"textarea"},le={class:"tool"},ne=C('<div class="iconItem" data-v-c1a54d30><div class="topic" data-v-c1a54d30><svg class="icon" aria-hidden="true" data-v-c1a54d30><use xlink:href="#icon-hashjinghao" data-v-c1a54d30></use></svg></div><div class="at" data-v-c1a54d30> @ </div><div class="emoji" data-v-c1a54d30><svg class="icon" aria-hidden="true" data-v-c1a54d30><use xlink:href="#icon-xiaolian1" data-v-c1a54d30></use></svg></div></div>',1),oe=ee((()=>s("div",{class:"iconItem"},[s("svg",{class:"icon","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-chahao"})])],-1))),ie={class:"text"},se={class:"content"},me={key:0,class:"noComment"},ue={key:1,class:"hotComment"},de=ee((()=>s("div",{class:"title"},"精彩评论",-1))),ve={key:2,class:"moreHotComment"},ce={key:3,class:"latestComment"},re={class:"title"},pe={class:"pagination"},he=b(t({__name:"Comment",props:{type:{type:Number,required:!0},changeCommentCount:{type:Function,required:!0}},setup(e,{expose:t}){const a=e,n=D(),c=l();let p=l(""),g=l(),C=l(),y=l(),I=l(0),x=l(1),b=l(100),F=l(!1),L=l("");const R=140;let z=l(R),G=l(!1),O=l(""),A=l();const H=(e,t)=>{j({id:n.params.id,cid:e,t:t,type:a.type}).then((e=>{setTimeout((()=>{P()}),500)}))},N=(e,t)=>{q({id:n.params.id,t:e,content:G.value?p.value.slice(O.value.length):p.value,commentId:t||"",type:a.type}).then((e=>{p.value="",A.value=void 0,G.value=!1,O.value="",z.value=R,setTimeout((()=>{P()}),500)}))},P=()=>{switch(a.type){case B.playlist:U(b.value,(x.value-1)*b.value);break;case B.album:X(b.value,(x.value-1)*b.value)}},U=(e,t,l)=>{w({id:n.params.id,limit:e,offset:t}).then((e=>{var t;g.value=null==e?void 0:e.comments,I.value=e.total,C.value=null==(t=null==e?void 0:e.hotComments)?void 0:t.slice(0,10),y.value=null==e?void 0:e.moreHot,a.changeCommentCount(e.total)}))},X=(e,t,l)=>{S({id:n.params.id,limit:e,offset:t}).then((e=>{var t;g.value=null==e?void 0:e.comments,I.value=e.total,C.value=null==(t=null==e?void 0:e.hotComments)?void 0:t.slice(0,10),y.value=null==e?void 0:e.moreHot,a.changeCommentCount(e.total)}))},Y=e=>{F.value=!0,L.value=e,setTimeout((()=>{F.value=!1}),1e3)},J=()=>{G.value?p.value.slice(0,O.value.length)!=O.value?(G.value=!1,z.value=R-p.value.length):z.value=R-p.value.length+O.value.length:z.value=R-p.value.length},M=e=>{G.value=!0,p.value="回复"+e.user.nickname+"：",z.value=R,O.value=p.value,A.value=e.commentId,c.value.focus()},Q=e=>{N(0,e.commentId)};return f((()=>x.value),(()=>{g.value=[],C.value=[],P()}),{immediate:!0}),t({getComment:P}),(e,t)=>{var a,l,n,f,D;const w=E;return o(),i("div",te,[s("div",ae,[r(s("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>h(p)?p.value=e:p=e),class:"textarea customeScroll",name:"saysths",rows:"3",wrap:"soft",onInput:J,ref_key:"textareaRef",ref:c},null,544),[[T,m(p)]]),s("span",{class:v(["commentTextCount",{outLimit:m(z)<0}])},u(m(z)),3)]),s("div",le,[ne,s("div",{class:v(["noContentTip",{showNoContentTip:m(F)}])},[oe,s("div",ie,u(m(L)),1)],2),s("div",{class:"sendComment",onClick:t[1]||(t[1]=e=>{p.value?z.value<0?Y("字数超过限制"):G.value&&A.value?N(2,A.value):N(1):Y("写点东西吧，内容不能为空哦！")})},"评论")]),s("div",se,[(null==(a=m(g))?void 0:a.length)||(null==(l=m(C))?void 0:l.length)?d("",!0):(o(),i("div",me," 还没有评论，快来抢沙发~ ")),(null==(n=m(C))?void 0:n.length)?(o(),i("div",ue,[de,(o(!0),i(k,null,$(m(C),((e,t)=>(o(),i("div",{class:"contentItem borderBottom",key:t},[_(Z,{"comment-item":e,"like-comment-button":H,"reply-comment":M,"delete-comment":Q},null,8,["comment-item"])])))),128))])):d("",!0),(null==(f=m(C))?void 0:f.length)&&m(y)?(o(),i("div",ve," 更多精彩评论 > ")):d("",!0),(null==(D=m(g))?void 0:D.length)?(o(),i("div",ce,[s("div",re,"最新评论("+u(m(I))+")",1),(o(!0),i(k,null,$(m(g),((e,t)=>{var a;return o(),i("div",{class:v(["contentItem",{borderBottom:t!=(null==(a=m(g))?void 0:a.length)-1}]),key:t},[_(Z,{"comment-item":e,"like-comment-button":H,"reply-comment":M,"delete-comment":Q},null,8,["comment-item"])],2)})),128))])):d("",!0),s("div",pe,[_(w,{small:"",background:"",layout:"prev, pager, next",total:m(I),"page-size":m(b),"current-page":m(x),"onUpdate:current-page":t[2]||(t[2]=e=>h(x)?x.value=e:x=e),"hide-on-single-page":!0,class:"mt-4"},null,8,["total","page-size","current-page"])])])])}}}),[["__scopeId","data-v-c1a54d30"]]);export{he as C,B as c};
